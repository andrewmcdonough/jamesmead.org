#
# Virtual Hosts
#
# If you want to maintain multiple domains/hostnames on your
# machine you can setup VirtualHost containers for them. Most configurations
# use only name-based virtual hosts so the server doesn't need to worry about
# IP addresses. This is indicated by the asterisks in the directives below.
#
# Please see the documentation at 
# <URL:http://httpd.apache.org/docs/2.2/vhosts/>
# for further details before you try to setup virtual hosts.
#
# You may use the command line option '-S' to verify your virtual host
# configuration.

#
# Use name-based virtual hosting.
#
NameVirtualHost *:80

#
# VirtualHost example:
# Almost any Apache directive may go into a VirtualHost container.
# The first VirtualHost section is used for all requests that do not
# match a ServerName or ServerAlias in any <VirtualHost> block.
#
#<VirtualHost *:80>
#    ServerAdmin webmaster@dummy-host.example.com
#    DocumentRoot /www/docs/dummy-host.example.com
#    ServerName dummy-host.example.com
#    ServerAlias www.dummy-host.example.com
#    ErrorLog /var/log/apache2/dummy-host.example.com-error_log
#    CustomLog /var/log/apache2/dummy-host.example.com-access_log common
#</VirtualHost>
#
#<VirtualHost *:80>
#    ServerAdmin webmaster@dummy-host2.example.com
#    DocumentRoot /www/docs/dummy-host2.example.com
#    ServerName dummy-host2.example.com
#    ErrorLog /var/log/apache2/dummy-host2.example.com-error_log
#    CustomLog /var/log/apache2/dummy-host2.example.com-access_log common
#</VirtualHost>

<VirtualHost *:80>
        ServerName floehopper.co.uk
        DocumentRoot /var/www/floehopper.co.uk
        RewriteEngine On
	RewriteCond %{HTTP_HOST}   !^floehopper\.com [NC]
	RewriteCond %{HTTP_HOST}   !^$
	RewriteRule ^/(.*)         http://floehopper.com/$1 [R=301,L]
</VirtualHost>
<VirtualHost *:80>
        ServerName floehopper.com
        DocumentRoot /var/www/floehopper.com
</VirtualHost>
<VirtualHost *:80>
        ServerName floehopper.org
        DocumentRoot /var/www/floehopper.org
        RewriteEngine On
	RewriteCond %{HTTP_HOST}   !^blog\.floehopper\.org [NC]
	RewriteCond %{HTTP_HOST}   !^$
	RewriteRule ^/(.*)         http://blog.floehopper.org/$1 [R=301,L]
</VirtualHost>
<VirtualHost *:80>
        ServerName www.floehopper.org
        DocumentRoot /var/www/www.floehopper.org
        RewriteEngine On
	RewriteCond %{HTTP_HOST}   !^blog\.floehopper\.org [NC]
	RewriteCond %{HTTP_HOST}   !^$
	RewriteRule ^/(.*)         http://blog.floehopper.org/$1 [R=301,L]
</VirtualHost>

<VirtualHost *:80>
        ServerName blog.floehopper.org
        DocumentRoot /home/floehopper/projects/floehopper/public
        <Directory "/home/floehopper/projects/floehopper/public">
          Options FollowSymLinks
          AllowOverride None
          Order allow,deny
          Allow from all
        </Directory>

        RewriteEngine On

        # Legacy feed redirects
        RewriteRule ^/xml/atom/feed.xml http://feeds.jamesmead.org/floehopper-blog [R=301,L]
        RewriteRule ^/xml/atom10/feed.xml http://feeds.jamesmead.org/floehopper-blog [R=301,L]
        RewriteRule ^/xml/rss/feed.xml http://feeds.jamesmead.org/floehopper-blog [R=301,L]
        RewriteRule ^/xml/rss20/feed.xml http://feeds.jamesmead.org/floehopper-blog [R=301,L]

        # Feedburner source
        # I don't think this is needed for now - we can just point feedburner at the new source
        # as long as this source url has never been used externally and I think it hasn't
        # RewriteRule ^/feedburner.xml http://jamesmead.org/blog/index.xml [R=301,L]

        # Legacy article index
        RewriteRule ^/articles/?$ http://jamesmead.org/blog/ [R=301,L]
        RewriteRule ^/articles/page/.+$ http://jamesmead.org/blog/ [R=301,L]
        RewriteRule ^/articles/tag/?.*$ http://jamesmead.org/legacy/tags [R=301,L]
        RewriteRule ^/articles/category/?.*$ http://jamesmead.org/legacy/categories [R=301,L]
        RewriteRule ^/articles/markup_help/5 http://redcloth.org/hobix.com/textile/ [R=301,L]

        # Legacy Typo-style yearly archives
        RewriteRule ^/articles/([0-9]{4})/?$ http://jamesmead.org/legacy/archives [R=301,L]
        RewriteRule ^/articles/([0-9]{4})/page/.+$ http://jamesmead.org/legacy/archives [R=301,L]

        # Legacy Typo-style monthly archives
        RewriteRule ^/articles/([0-9]{4})/([0-9]{1,2})/?$ http://jamesmead.org/legacy/archives [R=301,L]
        RewriteRule ^/articles/([0-9]{4})/([0-9]{1,2})/page/.+$ http://jamesmead.org/legacy/archives [R=301,L]

        # Legacy Typo-style daily archives
        RewriteRule ^/articles/([0-9]{4})/([0-9]{2})/([0-9]{1,2})/?$ http://jamesmead.org/legacy/archives [R=301,L]
        RewriteRule ^/articles/([0-9]{4})/([0-9]{2})/([0-9]{1,2})/page/.+$ http://jamesmead.org/legacy/archives [R=301,L]

        # Legacy Typo-style articles
        RewriteRule ^/articles/([0-9]{4})/([0-9]{2})/([0-9]{2})/(.+)$ http://jamesmead.org/blog/$1-$2-$3-$4 [R=301,L]

        # Legacy presentations
        RewriteRule ^/presentations/lrug-mock-objects-2007-07-09/ http://jamesmead.org/talks/2007-07-09-introduction-to-mock-objects-in-ruby-at-lrug/ [R=301,L]
        RewriteRule ^/presentations/ruby-and-cocoa-ruby-manor-2009-12-14/ http://jamesmead.org/talks/2009-12-14-ruby-and-cocoa-at-ruby-manor/ [R=301,L]

        # New domain
        RewriteCond %{HTTP_HOST}   !^jamesmead\.org [NC]
        RewriteCond %{HTTP_HOST}   !^$
        RewriteRule ^/(.*)$        http://jamesmead.org/$1 [R=301,L]

        ErrorLog /var/log/apache2/blog.floehopper.org-error_log
        CustomLog /var/log/apache2/blog.floehopper.org-access_log common

        RewriteLogLevel 3
        RewriteLog /var/log/apache2/blog.floehopper.org-rewrite_log
</VirtualHost>

<VirtualHost *:80>
        ServerName cruise.floehopper.org
        DocumentRoot /var/www/cruise.floehopper.org
        ProxyRequests Off
        ProxyPass / http://localhost:8001/
        ProxyPassReverse / http://localhost:8001/
        ProxyPreserveHost On
</VirtualHost>
<VirtualHost *:80>
        ServerName hannahsmithson.org
        DocumentRoot /var/www/www.hannahsmithson.org
</VirtualHost>
<VirtualHost *:80>
        ServerName www.hannahsmithson.org
        DocumentRoot /var/www/www.hannahsmithson.org
</VirtualHost>
<VirtualHost *:80>
        ServerName sparkymagic.com
        DocumentRoot /var/www/www.sparkymagic.com
</VirtualHost>
<VirtualHost *:80>
        ServerName www.sparkymagic.com
        DocumentRoot /var/www/www.sparkymagic.com
</VirtualHost>
<VirtualHost *:80>

        ServerName installd.com
        DocumentRoot /home/floehopper/projects/installd/webapp/public
        <Directory "/home/floehopper/projects/installd/webapp/public">
          Options FollowSymLinks
          AllowOverride None
          Order allow,deny
          Allow from all
        </Directory>

        ###########################################
        # PASSENGER
        ###########################################
        RailsEnv production

</VirtualHost>
